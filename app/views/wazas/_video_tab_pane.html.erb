<div class="tab-content">
  <div class="tab-pane active" id="tab<%= video.aiki_format.id %>">
      <br/>
      <div class="row pad_sides">
        <div class="col-md-12"><label><%= video.format %>:&nbsp;</label></div>
      </div>
      <br/>

      <%
        videos = waza.videos.where(aiki_format: video.aiki_format)
        ranks = videos.map(&:rank).sort_by(&:id).uniq

        iaido = video.iaido? 

        ranks.each do |rank|
      %>
        <div class="row pad_sides">
          <div class="col-md-12">
            <table class="table table-striped table-bordered">
              <thead class="rank_row">
                <th colspan="<%= iaido ? 7 : 6 %>"><%= rank %></th>
              </thead>
              <thead>
                <th></th>
                <th>Video</th>
                <% if iaido %>
                  <th>Kata</th>
                <% end %>
                <th>Format(s)</th>
                <th>On Test</th>
                <th>Sensei</th>
                <th>Style</th>
              </thead>
              <tbody>

                <% videos.each do |vid| %>
                  <%
                    next unless vid.rank.id == rank.id
                  %>
                  <tr>
                    <td>
                      <% if vid.id == video.id %>
                        <strong>&check;</strong>
                      <% end %>
                    </td>
                    <td>
                      <%= link_to "#{vid}", waza_remote_display_path(waza_id: vid.waza, video_id: vid.id), remote: true %>
                    </td>
                    <% if iaido %>
                      <td>
                        <%= vid.kata if vid.kata %>
                      </td>
                    <% end %>
                    <td>
                      <%= vid.format %>
                    </td>
                    <td>
                      <%= video.on_test? ? 'Yes' : 'No' %>
                    </td>
                    <td>
                      <%= vid.sensei rescue '' %>
                    </td>
                    <td>
                      <%= vid.style rescue '' %>
                    </td>
                  </tr>
                <% end %>

              </tbody>
            </table>
          </div>
        </div> <!-- table div -->

      <% end %> <!-- ranks -->

  </div>
</div>

<%= render 'video', video: video, waza: waza %>


